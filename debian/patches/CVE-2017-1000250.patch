Origin: https://git.kernel.org/pub/scm/bluetooth/bluez.git/commit/?id=9e009647b14e810e06626dde7f1bb9ea3c375d09
Reviewed-by: Sylvain Beucler <beuc@debian.org>
Last-Update: 2021-11-24

From 9e009647b14e810e06626dde7f1bb9ea3c375d09 Mon Sep 17 00:00:00 2001
From: Luiz Augusto von Dentz <luiz.von.dentz@intel.com>
Date: Wed, 13 Sep 2017 10:01:40 +0300
Subject: sdp: Fix Out-of-bounds heap read in service_search_attr_req function

Check if there is enough data to continue otherwise return an error.
---
 src/sdpd-request.c | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

Index: bluez-5.43/src/sdpd-request.c
===================================================================
--- bluez-5.43.orig/src/sdpd-request.c
+++ bluez-5.43/src/sdpd-request.c
@@ -917,7 +917,7 @@ static int service_search_attr_req(sdp_r
 	} else {
 		/* continuation State exists -> get from cache */
 		sdp_buf_t *pCache = sdp_get_cached_rsp(cstate);
-		if (pCache) {
+		if (pCache && cstate->cStateValue.maxBytesSent < pCache->data_size) {
 			uint16_t sent = MIN(max, pCache->data_size - cstate->cStateValue.maxBytesSent);
 			pResponse = pCache->data;
 			memcpy(buf->data, pResponse + cstate->cStateValue.maxBytesSent, sent);
